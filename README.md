# SimpleEasy

Minimal Python starter with tests.

## Quickstart
1. Install Python 3.10+.
2. Run `make setup` to install deps.
3. Run `make test` to execute tests.
4. Run `make dev` to print a greeting (uses `APP_NAME`).

Example: `APP_NAME=Alice make dev` → `Hello, Alice!`

### CLI
- Install locally (editable): `pip install -e .`
- Run: `simpleeasy` (respects `APP_NAME`, `APP_LANG`, `APP_TIME_GREET`)

## Requirements
- Python 3.10 or newer
- Pip and Make

## Environment
- `APP_NAME`: name to greet (default: `world`).
- `APP_LANG`: language code, `en` or `pt` (default: `en`).
- `APP_TIME_GREET`: enable time-based greeting when `true`/`1`/`yes`/`on`.
- `APP_LOG_FORMAT`: `json` (default) or `plain` for server request logs.

Examples
- Localized: `APP_NAME=Ana APP_LANG=pt make dev` → `Olá, Ana!`
- Time-based: `APP_NAME=Ana APP_LANG=pt APP_TIME_GREET=true make dev`

## Pre-commit (optional)
1. Install: `pip install pre-commit`
2. Initialize: `pre-commit install`
3. Run on all files: `make precommit`

## HTTP API (optional)
- Install server deps: `pip install -r requirements-server.txt`
- Run server: `make serve` (FastAPI on http://127.0.0.1:8000)
- Examples:
  - `GET /hello?name=Alice&lang=en` → `{ "message": "Hello, Alice!" }`
  - `GET /hello?name=Ana&lang=pt&time=true` → time-based greeting in Portuguese
  - API docs: Swagger UI at `http://127.0.0.1:8000/docs` and ReDoc at `/redoc`

### API Reference
- `GET /hello`
  - Query params:
    - `name` (string, default `world`)
    - `lang` (string, `en` or `pt`, default `en`)
    - `time` (boolean, default `false`) — when true, returns time-based greeting
  - Responses: `{ "message": "..." }`
- `GET /health` → `{ "status": "ok" }`
- `GET /ready` → `{ "status": "ready" }`

### CORS Configuration
- Default allowed origins: `http://localhost:5173`, `http://127.0.0.1:5173`.
- To allow additional origins in production, set env `APP_CORS_ORIGINS` as a comma-separated list:
  - Example: `APP_CORS_ORIGINS=https://your-ui.example.com,https://staging-ui.example.com`

### Run via GHCR Image
- Pull: `docker pull ghcr.io/leandro1416/SimpleEasy:latest`
- Run: `docker run --rm -p 8000:8000 ghcr.io/leandro1416/SimpleEasy:latest`
- Health checks:
  - `GET http://127.0.0.1:8000/health` → `{ "status": "ok" }`
  - `GET http://127.0.0.1:8000/ready` → `{ "status": "ready" }`

## Troubleshooting
- Port already in use: override port with `PORT=8001 make serve` or `PORT=8001 make docker-run`.
- Pre-commit blocks commit: run `make precommit` (auto-fixes) then re-commit.
- Tests can’t import `src`: ensure `PYTHONPATH=src` when running tests or use `make test`.
- GHCR auth: if pulls fail, login with a Personal Access Token (classic, `read:packages`):
  - `echo $CR_PAT | docker login ghcr.io -u <user> --password-stdin`.

## Architecture
- Core: `src/app.py` implements pure greeting logic (localized and time-based) and a small CLI via `main()`.
- API: `src/server.py` exposes HTTP endpoints using FastAPI with access logging and health checks.
- Tests: `tests/` covers core logic and API behavior (async httpx + uvicorn for server tests).
- Tooling: Makefile targets for dev/test/lint/typecheck/serve/docker; pre-commit ensures formatting/lint.
- CI/CD: GitHub Actions runs tests, lint, typecheck, security audit; releases auto-generate notes and publish a Docker image to GHCR.

## Contributing
- Use PRs for changes; require passing CI.
- Suggested branch protection for `main`:
  - Require PR reviews (1+)
  - Require status checks (tests + lint) to pass
  - Restrict pushes to maintainers only
- Use Conventional Commits (`feat:`, `fix:`, `docs:`...).

## Releases
- Create a release by tagging `vX.Y.Z` and pushing the tag:
  - git tag v0.1.0 && git push origin v0.1.0
- CI runs tests and publishes a GitHub Release with autogenerated notes.
